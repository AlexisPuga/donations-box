{% from './lib/build-ammount.njk' import buildAmmount %}
<link rel='stylesheet' href='/css/donation-box.min.css'/>
<aside id='donation-box' data-theme='compact' class='d10x-c'>
	<h1>Donations</h1>
	<ol class='donations'>
		{% for donation in donations %}
			{% set type = donation.type %}
			{% set href = donation.href %}
			{% set title = donation.title %}
			{% set ammounts = donation.ammounts %}
			{% if type == 'one-off' %}
				{% set ammount = ammounts | first %}
				{% set ammountHref = ammount.href %}
				<li class='donation one-off-donation'>
					{# @FIXME [Nunjucks bug] Calling a macro (using call()/caller()) won't pass variables defined in this scope, inside the call() block. #}
					<a class='external-link' href='{{ ammountHref if ammountHref else href }}' target='{{ "_blank" if openInNewWindow else "_self" }}' rel='noopener noreferrer'>
						{{ buildAmmount(ammount) }}
						<span class='title'>{{ title }}</span>
					</a>
				</li>
			{% elseif type == 'recurrent' %}
				<li class='donation recurrent-donation'>
					<span class='title'>{{ title }}</span>
					<ul class='ammounts'>
						{%- for ammount in ammounts -%}
							{%- set ammountHref = ammount.href -%}
							<li class='ammount'>
								<a class='external-link' href='{{ ammountHref if ammountHref else href }}' target='{{ "_blank" if openInNewWindow else "_self" }}' rel='noopener noreferrer'>
									{{ buildAmmount(ammount) }}
								</a>
							</li>
						{%- endfor -%}
					</ul>
				</li>
			{% endif %}
		{% endfor %}
	</ol>
</aside>
