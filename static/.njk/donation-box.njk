{% from './lib/build-amount.njk' import buildAmount %}
{% set small = size == 'small' %}
<link rel='stylesheet' href='/css/donation-box.min.css'/>
<aside id='donation-box' data-theme='compact' class='d10x-c'>
	<header class='header'>
		<p class='beneficiary'><span class='alias'>{{ beneficiary.alias }}</span></p>
		<h1>Donations</h1>
	</header>
	<ol class='donations'>
		{% for donation in donations %}
			{% set type = donation.type %}
			{% set href = donation.href %}
			{% set title = donation.title %}
			{% set amounts = donation.amounts %}
			{% if type == 'one-off' %}
				{% set amount = amounts | first %}
				{% set amountHref = amount.href %}
				<li class='donation one-off-donation'>
					{# @FIXME [Nunjucks bug] Calling a macro (using call()/caller()) won't pass variables defined in this scope, inside the call() block. #}
					<a class='external-link' href='{{ amountHref if amountHref else href }}' target='{{ "_blank" if openInNewWindow else "_self" }}' rel='noopener noreferrer'>
						{{- buildAmount(amount) | trim -}}
						<span class='title'>{{ title }}</span>
					</a>
				</li>
			{% elseif type == 'recurrent' %}
				<li class='donation recurrent-donation'>
					<span class='title'>{{ title }}</span>
					{% if small %}
					<br>
					{% endif %}
					<ul class='quantities'>
						{%- for amount in amounts -%}
							{%- set amountHref = amount.href -%}
							<li class='quantity'>
								<a class='external-link' href='{{ amountHref if amountHref else href }}' target='{{ "_blank" if openInNewWindow else "_self" }}' rel='noopener noreferrer'>
									{{ buildAmount(amount) }}
								</a>
							</li>
						{%- endfor -%}
					</ul>
				</li>
			{% endif %}
		{% endfor %}
	</ol>
</aside>
